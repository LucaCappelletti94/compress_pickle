language: python
sudo: required

cache:
  directories:
    - $HOME/miniconda3

before_install:
  - . ./scripts/install_miniconda.sh

install:
  - . ./scripts/create_testenv.sh
  - pip install coveralls
  - conda list && pip freeze

jobs:
  include:
    - stage: "Tests"
      script:
        - ./scripts/run_tests.sh
    - stage: "Deploy"
      if: branch = master AND type = push AND env(PYTHON_VERSION) = 3.7 AND env(TEST_DOCS) IS present
      env:
        - PYTHON_VERSION=3.7 TEST_DOCS="True"
      script: skip
      deploy:
        provider: pages
        github_token: $GITHUB_TOKEN
        keep_history: true
        local_dir: docs/html
        target_branch: master

stages:
  - Tests
  - name: "Deploy"
    if: branch = master AND type = push AND env(PYTHON_VERSION) = 3.7 AND env(TEST_DOCS) IS present

env:
  - PYTHON_VERSION=3.5
  - PYTHON_VERSION=3.6 TEST_STYLE="True"
  - PYTHON_VERSION=3.7 TEST_STYLE="True"
  - PYTHON_VERSION=3.7 TEST_DOCS="True"

after_success:
  - coveralls
